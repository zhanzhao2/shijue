<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>🏠 小区人脸系统 - 智能门禁管理</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <main class="container">
      <h1 class="floating">🔍 小区人脸识别系统</h1>
      
      <nav class="nav">
        <a class="button" href="/register.html">
          👤 人脸注册
        </a>
        <a class="button secondary" href="/recognize.html">
          🎯 人脸识别
        </a>
      </nav>

      <section class="card info-section">
        <h2>📊 已注册人员</h2>
        <div id="peopleCount" class="status">正在加载...</div>
        <ul id="peopleList" class="list"></ul>
        <div id="emptyState" style="display: none; text-align: center; padding: 40px; color: #6b7280;">
          <div style="font-size: 48px; margin-bottom: 16px;">👥</div>
          <p>还没有注册用户</p>
          <p>点击上方"人脸注册"开始添加用户</p>
        </div>
      </section>

      <div class="card" style="text-align: center; margin-top: 24px;">
        <h2>🚀 系统特性</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
          <div style="padding: 16px; background: rgba(102, 126, 234, 0.1); border-radius: 12px;">
            <div style="font-size: 32px; margin-bottom: 8px;">⚡</div>
            <strong>实时识别</strong>
            <p style="font-size: 14px; color: #6b7280; margin: 4px 0 0;">毫秒级响应速度</p>
          </div>
          <div style="padding: 16px; background: rgba(239, 68, 68, 0.1); border-radius: 12px;">
            <div style="font-size: 32px; margin-bottom: 8px;">🛡️</div>
            <strong>安全可靠</strong>
            <p style="font-size: 14px; color: #6b7280; margin: 4px 0 0;">本地数据存储</p>
          </div>
          <div style="padding: 16px; background: rgba(16, 185, 129, 0.1); border-radius: 12px;">
            <div style="font-size: 32px; margin-bottom: 8px;">📱</div>
            <strong>易于使用</strong>
            <p style="font-size: 14px; color: #6b7280; margin: 4px 0 0;">简单直观的界面</p>
          </div>
        </div>
      </div>
    </main>

    <script>
      async function refreshPeople() {
        try {
          const countEl = document.getElementById('peopleCount');
          const listEl = document.getElementById('peopleList');
          const emptyEl = document.getElementById('emptyState');
          
          countEl.innerHTML = '<span class="loading"></span> 正在加载...';
          
          const res = await fetch('/cv/people');
          const data = await res.json();
          const people = data.people || [];
          
          if (people.length === 0) {
            countEl.textContent = '暂无注册用户';
            listEl.style.display = 'none';
            emptyEl.style.display = 'block';
          } else {
            countEl.textContent = `共有 ${people.length} 名已注册用户`;
            listEl.style.display = 'block';
            emptyEl.style.display = 'none';
            
            listEl.innerHTML = '';
            people.forEach((p, index) => {
              const li = document.createElement('li');
              const name = typeof p === 'string' ? p : p.name || p;
              li.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: between;">
                  <span>👤 ${name}</span>
                  <small style="color: #6b7280; margin-left: auto;">#${index + 1}</small>
                </div>
              `;
              listEl.appendChild(li);
              
              // 添加进入动画延迟
              setTimeout(() => {
                li.style.opacity = '0';
                li.style.transform = 'translateY(20px)';
                li.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                setTimeout(() => {
                  li.style.opacity = '1';
                  li.style.transform = 'translateY(0)';
                }, index * 100);
              }, 10);
            });
          }
        } catch (e) {
          console.error(e);
          document.getElementById('peopleCount').innerHTML = 
            '<span style="color: #ef4444;">❌ 加载失败</span>';
        }
      }
      
      // 页面加载时刷新列表
      refreshPeople();
      
      // 每30秒自动刷新一次
      setInterval(refreshPeople, 30000);
    </script>
  </body>
</html>